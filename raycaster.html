<!DOCTYPE html>
<html>
<canvas id = "render">

</canvas><style>
body {
    margin:0;
	background-color:#333333;
}


</style><script>
var c = document.getElementById("render");
var ctx = c.getContext("2d");
keys = [];
var angle = 0
var speed = 5
var playerX = 100
var playerY = 100
var playerRotX = 0
var playerRotY = 0
var length = 500
var rays = 10
var raysDistance = 3
var mapSize = 50

var map = [ // currently 7x7 map
    [1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 1, 1, 1, 1, 1],
	[1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 1],
	[1, 0, 0, 1, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 1],
	[1, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 1],
	[1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 1],
	[1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1],
	[1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 1, 1, 1, 1, 1, 1],
	[1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 1, 1, 1, 1, 1, 1],
	[1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 1, 1, 1, 1, 1, 1],
	[1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 1, 1, 1, 1, 1],
	[1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 1, 1, 1, 1, 1],
	[1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 1, 1, 1, 1, 1],
	[1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1],
	[1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1],
	[1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1],
	[1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1],
	[1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1],
];
c.width = window.innerWidth;
c.height = window.innerHeight;

/*ctx.moveTo(0, 0);
ctx.lineTo(500, 500);
ctx.stroke();*/

document.addEventListener('keydown', (event) => {keys[event.key] = true;}, false);
document.addEventListener('keyup', (event) => {keys[event.key] = false;}, false);

ctx.fillStyle = "#FFFFFF";
ctx.strokeStyle = "#999999";

function main() {
    if (keys["w"] == true) {
		playerRotX = Math.cos(angle + rays/40 + Math.PI / 180);
		playerRotY = Math.sin(angle + rays/40 + Math.PI / 180);
        playerX -= playerRotX*speed;
        playerY -= playerRotY*speed;

        ctx.moveTo(playerX, playerY);
    } // going forward
    if (keys["s"] == true) {
		playerRotX = Math.cos(angle + rays/40 + Math.PI / 180);
		playerRotY = Math.sin(angle + rays/40 + Math.PI / 180);
        playerX += playerRotX*speed;
        playerY += playerRotY*speed;

        ctx.moveTo(playerX, playerY);
	} // going back
    if (keys["a"] == true) {} // going left
    if (keys["d"] == true) {} // going right
    if (keys["q"] == true) {angle -= 0.02;} // turning left
    if (keys["e"] == true) {angle += 0.02;} // turning right

    ctx.clearRect(0, 0, c.width, c.height); // clear screen
	
	// render map
	for (let i = 0; i < map.length; i++) 
	{
		for (let j = 0; j < map[i].length; j++) {
			if (map[j][i] == 1) 
			{
				ctx.beginPath();
				ctx.fillRect(i*mapSize,j*mapSize,mapSize,mapSize);
				ctx.stroke();
		
			}
			else 
			{
			}
		}
	}
    // Render player
    ctx.beginPath();
    //ctx.rotate(angle * Math.PI / 180);
    ctx.arc(playerX, playerY, 5, 0, 2 * Math.PI);
    ctx.stroke();


	// rays
	for (let i = 0; i < rays; i++)
	{
		playerRotX = Math.cos(angle+((i)*raysDistance) * Math.PI / 180);
		playerRotY = Math.sin(angle+((i)*raysDistance) * Math.PI / 180);
		
		ctx.moveTo(playerX, playerY); //from
		ctx.lineTo(playerX - playerRotX*length, playerY - playerRotY*length); //to
		ctx.stroke();
	};
}setInterval(main, 20);

</script>
</html>